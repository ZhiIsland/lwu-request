import{_ as n,H as o,o as t,c as e,C as s,a,J as p,V as r}from"./chunks/framework.d7491e17.js";const k=JSON.parse('{"title":"DOWNLOAD","description":"","frontmatter":{},"headers":[],"relativePath":"api/download.md","filePath":"api/download.md"}'),c={name:"api/download.md"},d={id:"download",tabindex:"-1"},F=s("a",{class:"header-anchor",href:"#download","aria-label":'Permalink to "DOWNLOAD <Badge type="tip" text="已发布" />"'},"​",-1),y=s("p",null,"下载文件资源到本地，客户端直接发起一个 HTTP GET 请求，返回文件的本地临时路径。",-1),D=s("div",{class:"warning custom-block"},[s("p",{class:"custom-block-title"},"注意事项"),s("p",null,"在各个小程序平台运行时，网络相关的 API 在使用前需要配置域名白名单。在h5上是跨域的，开发者需要处理好跨域问题。")],-1),i=s("h2",{id:"请求参数",tabindex:"-1"},[a("请求参数 "),s("a",{class:"header-anchor",href:"#请求参数","aria-label":'Permalink to "请求参数"'},"​")],-1),A=s("table",null,[s("thead",null,[s("tr",null,[s("th",null,"参数名"),s("th",null,"类型"),s("th",null,"必填"),s("th",null,"说明"),s("th",null,"平台差异说明")])]),s("tbody",null,[s("tr",null,[s("td",null,"url"),s("td",null,[s("code",null,"String")]),s("td",null,"是"),s("td",null,"下载资源的 url"),s("td")]),s("tr",null,[s("td",null,"domain"),s("td",null,[s("code",null,"String")]),s("td",null,"否"),s("td",null,[a("下载服务器域名，设置该参数时 "),s("code",null,"全局配置"),a(" 的 "),s("code",null,"baseUrl"),a(" 将失效。")]),s("td")]),s("tr",null,[s("td",null,"header"),s("td",null,[s("code",null,"Object")]),s("td",null,"否"),s("td",null,"HTTP 请求 Header, header 中不能设置 Referer。"),s("td")]),s("tr",null,[s("td",null,"timeout"),s("td",null,[s("code",null,"Number")]),s("td",null,"否"),s("td",null,[a("超时时间，单位 ms，默认值为 "),s("code",null,"60000")]),s("td",null,"H5(HBuilderX 2.9.9+)、APP(HBuilderX 2.9.9+)、微信小程序、支付宝小程序、字节跳动小程序、快手小程序")]),s("tr",null,[s("td",null,"filePath"),s("td",null,[s("code",null,"String")]),s("td",null,"否"),s("td",null,"指定文件下载后存储的路径 (本地路径)"),s("td",null,"小程序端支持（微信IOS小程序保存到相册需要添加此字段才可以正常保存）")]),s("tr",null,[s("td",null,"success"),s("td",null,[s("code",null,"Function")]),s("td",null,"否"),s("td",{"tempFilePath:":"",文件的临时路径:""},"下载成功后以 tempFilePath 的形式传给页面，res ="),s("td")]),s("tr",null,[s("td",null,"fail"),s("td",null,[s("code",null,"Function")]),s("td",null,"否"),s("td",null,"接口调用失败的回调函数"),s("td")]),s("tr",null,[s("td",null,"complete"),s("td",null,[s("code",null,"Function")]),s("td",null,"否"),s("td",null,"接口调用结束的回调函数（调用成功、失败都会执行）"),s("td")])])],-1),C=r(`<p><strong>注：文件的临时路径，在应用本次启动期间可以正常使用，如需持久保存，需在主动调用 <a href="https://uniapp.dcloud.net.cn/api/file/file#savefile" target="_blank" rel="noreferrer">uni.saveFile</a>，才能在应用下次启动时访问得到。</strong></p><h4 id="success-返回参数说明" tabindex="-1">success 返回参数说明 <a class="header-anchor" href="#success-返回参数说明" aria-label="Permalink to &quot;success 返回参数说明&quot;">​</a></h4><table><thead><tr><th>参数名</th><th>类型</th><th>说明</th><th>平台差异说明</th></tr></thead><tbody><tr><td>tempFilePath</td><td><code>String</code></td><td>临时文件路径，下载后的文件会存储到一个临时文件</td><td>微信小程序、支付宝小程序、百度小程序、字节跳动小程序、飞书小程序</td></tr><tr><td>statusCode</td><td><code>Number</code></td><td>开发者服务器返回的 HTTP 状态码</td><td>微信小程序、QQ小程序、百度小程序、字节跳动小程序、飞书小程序</td></tr><tr><td>apFilePath</td><td><code>String</code></td><td>下载文件保存的路径（本地临时文件）。入参未指定 filePath 的情况下可用</td><td>支付宝小程序</td></tr><tr><td>filePath</td><td><code>String</code></td><td>用户文件路径 (本地路径)。传入 filePath 时会返回，跟传入的 filePath 一致</td><td>微信小程序、支付宝小程序、字节跳动小程序、飞书小程序</td></tr><tr><td>fileContent</td><td><code>Buffer</code></td><td>文件内容</td><td>QQ小程序</td></tr></tbody></table><h2 id="返回值" tabindex="-1">返回值 <a class="header-anchor" href="#返回值" aria-label="Permalink to &quot;返回值&quot;">​</a></h2><p>返回值为 <code>downloadTask</code> 对象。通过 <code>downloadTask</code>，可监听下载进度变化事件，以及取消下载任务。</p><h4 id="downloadtask-对象的方法列表" tabindex="-1">downloadTask 对象的方法列表 <a class="header-anchor" href="#downloadtask-对象的方法列表" aria-label="Permalink to &quot;downloadTask 对象的方法列表&quot;">​</a></h4><table><thead><tr><th>方法</th><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>abort</td><td></td><td>中断下载任务</td></tr><tr><td>onProgressUpdate</td><td>callback</td><td>监听下载进度变化</td></tr><tr><td>onHeadersReceived</td><td>callback</td><td>监听 HTTP Response Header 事件，会比请求完成事件更早,仅<code>微信小程序平台</code>支持，<a href="https://developers.weixin.qq.com/miniprogram/dev/api/DownloadTask.onHeadersReceived.html" target="_blank" rel="noreferrer">规范详情</a></td></tr><tr><td>offProgressUpdate</td><td>callback</td><td>取消监听下载进度变化事件，仅<code>微信小程序平台</code>支持，<a href="https://developers.weixin.qq.com/miniprogram/dev/api/DownloadTask.offProgressUpdate.html" target="_blank" rel="noreferrer">规范详情</a></td></tr><tr><td>offHeadersReceived</td><td>callback</td><td>取消监听 HTTP Response Header 事件，仅<code>微信小程序平台</code>支持，<a href="https://developers.weixin.qq.com/miniprogram/dev/api/DownloadTask.offHeadersReceived.html" target="_blank" rel="noreferrer">规范详情</a></td></tr></tbody></table><h4 id="onprogressupdate-返回参数说明" tabindex="-1">onProgressUpdate 返回参数说明 <a class="header-anchor" href="#onprogressupdate-返回参数说明" aria-label="Permalink to &quot;onProgressUpdate 返回参数说明&quot;">​</a></h4><table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>progress</td><td><code>Number</code></td><td>下载进度百分比</td></tr><tr><td>totalBytesWritten</td><td><code>Number</code></td><td>已经下载的数据长度，单位 Bytes</td></tr><tr><td>totalBytesExpectedToWrite</td><td><code>Number</code></td><td>预期需要下载的数据总长度，单位 Bytes</td></tr></tbody></table><h2 id="使用示例" tabindex="-1">使用示例 <a class="header-anchor" href="#使用示例" aria-label="Permalink to &quot;使用示例&quot;">​</a></h2><h4 id="基本使用" tabindex="-1">基本使用 <a class="header-anchor" href="#基本使用" aria-label="Permalink to &quot;基本使用&quot;">​</a></h4><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">download</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/file/test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 仅为示例，并非真实的资源</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">domain</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://www.example.com</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 请求域名,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">success</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">UniApp</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">DownloadSuccessData</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">下载成功</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h4 id="下载进度监听" tabindex="-1">下载进度监听 <a class="header-anchor" href="#下载进度监听" aria-label="Permalink to &quot;下载进度监听&quot;">​</a></h4><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> downloadTask </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">download</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/file/test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 仅为示例，并非真实的资源</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">domain</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://www.example.com</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 请求域名,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">success</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">UniApp</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">DownloadSuccessData</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">下载成功</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">downloadTask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onProgressUpdate</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">下载进度</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">progress</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">已经下载的数据长度</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">totalBytesWritten</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">预期需要下载的数据总长度</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">totalBytesExpectedToWrite</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">// 满足测试条件，取消下载任务。</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">progress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">50</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">downloadTask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">abort</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div>`,14);function u(h,f,m,b,g,_){const l=o("Badge");return t(),e("div",null,[s("h1",d,[a("DOWNLOAD "),p(l,{type:"tip",text:"已发布"}),a(),F]),y,D,i,A,C])}const w=n(c,[["render",u]]);export{k as __pageData,w as default};
